# 前后端请求路径配置说明

## 配置说明

为解决前后端路径不匹配问题，采用了 `/api` 前缀的代理机制。

### 1. 前端请求路径

**修改文件**：`src/api/index.js`

```javascript
const api = axios.create({
  baseURL: '/api/ai',  // ✅ 加上 /api 前缀
  timeout: 30000
})

// 所有请求都会带上 /api/ai 前缀
```

### 2. Vite代理配置

**修改文件**：`vite.config.js`

```javascript
export default defineConfig({
  server: {
    port: 3000,
    proxy: {
      '/api': {  // ✅ 匹配 /api 路径
        target: 'http://localhost:8080',  // ✅ 后端地址
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')  // ✅ 截取 /api 前缀
      }
    }
  }
})
```

### 3. 请求路径映射

| 前端发起请求 | Vite代理重写 | 后端实际接收 |
|-------------|-------------|-------------|
| `/api/ai/queryAllSessions` | → `/ai/queryAllSessions` | `http://localhost:8080/ai/queryAllSessions` |
| `/api/ai/createSession` | → `/ai/createSession` | `http://localhost:8080/ai/createSession` |
| `/api/ai/queryHistoryMessages/123` | → `/ai/queryHistoryMessages/123` | `http://localhost:8080/ai/queryHistoryMessages/123` |
| `/api/ai/chat` | → `/ai/chat` | `http://localhost:8080/ai/chat` |

### 4. 工作原理

```
前端请求 → Vite开发服务器 → 代理重写 → 后端服务器
   ↓           ↓              ↓          ↓
/api/ai/xxx → /api/ai/xxx → /ai/xxx → http://localhost:8080/ai/xxx
                  ↓         ↓        ↓
            匹配到 /api   截取前缀   实际请求
```

### 5. 优势

✅ **开发环境**：通过Vite代理，无跨域问题
✅ **生产环境**：后端可加/api路由前缀，前端无需修改
✅ **灵活配置**：统一/api前缀，便于管理
✅ **路径清晰**：区分前端路由和API路由

### 6. 后端接口

确保后端服务运行在 `http://localhost:8080`，提供以下接口：

- `GET  /ai/queryAllSessions` - 查询所有会话
- `GET  /ai/queryHistoryMessages/{sessionId}` - 查询历史消息
- `POST /ai/createSession` - 创建新会话
- `POST /ai/chat` - 发送聊天消息（SSE）

### 7. 测试验证

启动前端后，在浏览器Network面板中可以看到：

- 请求URL：`http://localhost:3000/api/ai/queryAllSessions`
- 实际发送到后端：`http://localhost:8080/ai/queryAllSessions`

两个地址都正常，说明代理配置成功！

---

**修改时间**：2025-11-30
**配置状态**：✅ 已完成
